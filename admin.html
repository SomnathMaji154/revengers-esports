<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Admin panel for Revengers Esports website management.">
    <meta name="keywords" content="esports admin, football gaming management, revengers admin panel">
    <meta name="author" content="Revengers Esports">
    <meta property="og:title" content="Admin - Revengers Esports">
    <meta property="og:description" content="Admin panel for Revengers Esports website management.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://revengers-esports.onrender.com/admin.html">
    <meta property="og:image" content="/uploads/logo.webp">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Admin - Revengers Esports">
    <meta name="twitter:description" content="Admin panel for Revengers Esports website management.">
    <meta name="twitter:image" content="/uploads/logo.webp">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
    <link rel="icon" href="/uploads/logo.webp" type="image/webp">
    <title>Admin - Revengers Esports</title>
</head>
<body>
    <header>
        <div class="logo">
            <img src="/uploads/logo.webp" alt="Revengers Esports Logo" class="header-logo">
        </div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="players.html">Players</a></li>
                <li><a href="managers.html">Managers</a></li>
                <li><a href="trophies.html">Trophies</a></li>
                <li><a href="contact.html">Contact Us</a></li>
                <li><a href="admin.html">Admin</a></li>
            </ul>
        </nav>
    </header>

    <main>
        <section id="login-section">
            <h1>Admin Login</h1>
            <p>Please login to access the admin panel.</p>
            <form id="login-form" method="POST" action="/api/admin/login">
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" required>
                <label for="password">Password:</label>
                <div class="password-container">
                    <input type="password" id="password" name="password" required>
                    <button type="button" id="toggle-password" class="toggle-password-btn">üëÅ</button>
                </div>
                <button type="submit">Login</button>
            </form>
        </section>

        <section id="admin-section" style="display: none;">
            <h1>Admin Panel</h1>
            <button id="logout-btn" class="btn btn-danger" style="float: right;">Logout</button>
            <p>Welcome to the Admin Panel.</p>
            
            <div id="database-management">
                <h2>Database Management</h2>
                <p><a href="registered-users.html">View Registered Users</a></p>
        
                <!-- Player Management -->
                <div id="player-management">
                    <h3>Player Management</h3>
                    <form id="add-player-form" enctype="multipart/form-data">
                        <h4>Add New Player</h4>
                        <div class="form-group">
                            <label for="playerName">Name:</label>
                            <input type="text" id="playerName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="playerJerseyNumber">Jersey Number:</label>
                            <input type="number" id="playerJerseyNumber" name="jerseyNumber" min="1" max="99" required>
                        </div>
                        <div class="form-group">
                            <label for="playerStars">Stars (1-5):</label>
                            <input type="number" id="playerStars" name="stars" min="1" max="5" required>
                        </div>
                        <div class="form-group">
                            <label for="playerImage">Player Image:</label>
                            <input type="file" id="playerImage" name="image" accept="image/*">
                        </div>
                        <!-- Hidden image preview - will be shown in modal -->
                        <div id="playerImageModal" class="image-modal" style="display: none;">
                            <div class="modal-content">
                                <span class="close">&times;</span>
                                <img id="playerImageModalImg" src="" alt="Image to crop">
                                <div class="cropper-container">
                                    <img id="playerCropperImg" src="" alt="Cropper">
                                </div>
                                <div class="modal-buttons">
                                    <button id="cropConfirm" type="button">Crop</button>
                                    <button id="cropCancel" type="button">Cancel</button>
                                </div>
                            </div>
                        </div>
                        <button type="submit">Add Player</button>
                    </form>
                    <div id="players-container">
                        <h4>Existing Players</h4>
                        <!-- Existing players will be loaded here -->
                    </div>
                </div>
        
                <!-- Manager Management -->
                <div id="manager-management">
                    <h3>Manager Management</h3>
                    <form id="add-manager-form" enctype="multipart/form-data">
                        <h4>Add New Manager</h4>
                        <div class="form-group">
                            <label for="managerName">Name:</label>
                            <input type="text" id="managerName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="managerRole">Role:</label>
                            <input type="text" id="managerRole" name="role" required>
                        </div>
                        <div class="form-group">
                            <label for="managerImage">Manager Image:</label>
                            <input type="file" id="managerImage" name="image" accept="image/*">
                        </div>
                        <!-- Hidden image preview - will be shown in modal -->
                        <div id="managerImageModal" class="image-modal" style="display: none;">
                            <div class="modal-content">
                                <span class="close">&times;</span>
                                <img id="managerImageModalImg" src="" alt="Image to crop">
                                <div class="cropper-container">
                                    <img id="managerCropperImg" src="" alt="Cropper">
                                </div>
                                <div class="modal-buttons">
                                    <button id="managerCropConfirm" type="button">Crop</button>
                                    <button id="managerCropCancel" type="button">Cancel</button>
                                </div>
                            </div>
                        </div>
                        <button type="submit">Add Manager</button>
                    </form>
                    <div id="managers-container">
                        <h4>Existing Managers</h4>
                        <!-- Existing managers will be loaded here -->
                    </div>
                </div>
        
                <!-- Trophy Management -->
                <div id="trophy-management">
                    <h3>Trophy Management</h3>
                    <form id="add-trophy-form" enctype="multipart/form-data">
                        <h4>Add New Trophy</h4>
                        <div class="form-group">
                            <label for="trophyName">Name:</label>
                            <input type="text" id="trophyName" name="name" required>
                        </div>
                        <div class="form-group">
                            <label for="trophyYear">Year:</label>
                            <input type="number" id="trophyYear" name="year" min="1900" max="2100" required>
                        </div>
                        <div class="form-group">
                            <label for="trophyImage">Trophy Image:</label>
                            <input type="file" id="trophyImage" name="image" accept="image/*">
                        </div>
                        <!-- Hidden image preview - will be shown in modal -->
                        <div id="trophyImageModal" class="image-modal" style="display: none;">
                            <div class="modal-content">
                                <span class="close">&times;</span>
                                <img id="trophyImageModalImg" src="" alt="Image to crop">
                                <div class="cropper-container">
                                    <img id="trophyCropperImg" src="" alt="Cropper">
                                </div>
                                <div class="modal-buttons">
                                    <button id="trophyCropConfirm" type="button">Crop</button>
                                    <button id="trophyCropCancel" type="button">Cancel</button>
                                </div>
                            </div>
                        </div>
                        <button type="submit">Add Trophy</button>
                    </form>
                    <div id="trophies-container">
                        <h4>Existing Trophies</h4>
                        <!-- Existing trophies will be loaded here -->
                    </div>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Revengers Esports. All rights reserved.</p>
    </footer>

    <style>
        .password-container {
            position: relative;
            display: flex;
            align-items: center;
        }
        
        .toggle-password-btn {
            position: absolute;
            right: 10px;
            background: none;
            border: none;
            font-size: 16px;
            cursor: pointer;
            color: #666;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .toggle-password-btn:hover {
            color: #333;
        }
        
        #password {
            padding-right: 40px;
        }
    </style>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js?v=<%= Date.now() %>"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loginSection = document.getElementById('login-section');
            const togglePasswordBtn = document.getElementById('toggle-password');
            const passwordInput = document.getElementById('password');
            const adminSection = document.getElementById('admin-section');
            const loginForm = document.getElementById('login-form');
            const logoutBtn = document.getElementById('logout-btn');

            // Password visibility toggle
            let passwordVisible = false;
            togglePasswordBtn.addEventListener('click', function() {
                passwordVisible = !passwordVisible;
                passwordInput.type = passwordVisible ? 'text' : 'password';
                togglePasswordBtn.textContent = passwordVisible ? 'üôà' : 'üëÅ';
            });

            let playerCropper; // Cropper.js instance for players
            let managerCropper; // Cropper.js instance for managers
            let trophyCropper; // Cropper.js instance for trophies

            // Check login status on page load
            checkLoginStatus();

            async function checkLoginStatus() {
                try {
                    const response = await fetch('/api/admin/status', { credentials: 'include' }); // Assuming a status endpoint
                    if (response.ok) {
                        const data = await response.json();
                        if (data.loggedIn) {
                            showAdminPanel();
                        } else {
                            showLoginForm();
                        }
                    } else {
                        showLoginForm();
                    }
                } catch (error) {
                    console.error('Error checking login status:', error);
                    showLoginForm();
                }
            }

            function showAdminPanel() {
                loginSection.style.display = 'none';
                adminSection.style.display = 'block';
                initializeDatabaseManagement();
            }

            function showLoginForm() {
                loginSection.style.display = 'block';
                adminSection.style.display = 'none';
            }

            // Handle login
            loginForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                try {
                    const response = await fetch('/api/admin/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'include',
                        body: JSON.stringify({ username, password })
                    });

                    if (response.ok) {
                        alert('Logged in successfully!');
                        showAdminPanel();
                    } else {
                        const errorData = await response.json();
                        alert(errorData.message || 'Login failed. Please try again.');
                    }
                } catch (error) {
                    console.error('Error during login:', error);
                    alert('An error occurred during login. Please try again.');
                }
            });

            // Handle logout
            logoutBtn.addEventListener('click', async function() {
                try {
                    const response = await fetch('/api/admin/logout', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'include'
                    });

                    if (response.ok) {
                        alert('Logged out successfully!');
                        showLoginForm();
                    } else {
                        const errorData = await response.json();
                        alert(errorData.message || 'Logout failed. Please try again.');
                    }
                } catch (error) {
                    console.error('Error during logout:', error);
                    alert('An error occurred during logout. Please try again.');
                }
            });

            // --- Database Management ---

            function initializeDatabaseManagement() {
                // API endpoints
                const API_ENDPOINTS = {
                    players: '/api/players',
                    managers: '/api/managers',
                    trophies: '/api/trophies'
                };

                // Containers
                const playersContainer = document.getElementById('players-container');
                const managersContainer = document.getElementById('managers-container');
                const trophiesContainer = document.getElementById('trophies-container');

                // Forms
                const addPlayerForm = document.getElementById('add-player-form');
                const addManagerForm = document.getElementById('add-manager-form');
                const addTrophyForm = document.getElementById('add-trophy-form');

                // Image inputs and modals
                const playerImageInput = document.getElementById('playerImage');
                const playerModal = document.getElementById('playerImageModal');
                const playerModalImg = document.getElementById('playerImageModalImg');
                const playerCropperImg = document.getElementById('playerCropperImg');
                const cropConfirm = document.getElementById('cropConfirm');
                const cropCancel = document.getElementById('cropCancel');

                const managerImageInput = document.getElementById('managerImage');
                const managerModal = document.getElementById('managerImageModal');
                const managerModalImg = document.getElementById('managerImageModalImg');
                const managerCropperImg = document.getElementById('managerCropperImg');
                const managerCropConfirm = document.getElementById('managerCropConfirm');
                const managerCropCancel = document.getElementById('managerCropCancel');

                const trophyImageInput = document.getElementById('trophyImage');
                const trophyModal = document.getElementById('trophyImageModal');
                const trophyModalImg = document.getElementById('trophyImageModalImg');
                const trophyCropperImg = document.getElementById('trophyCropperImg');
                const trophyCropConfirm = document.getElementById('trophyCropConfirm');
                const trophyCropCancel = document.getElementById('trophyCropCancel');

                // Load initial data
                loadAndDisplayData(API_ENDPOINTS.players, playersContainer, createPlayerCard);
                loadAndDisplayData(API_ENDPOINTS.managers, managersContainer, createManagerCard);
                loadAndDisplayData(API_ENDPOINTS.trophies, trophiesContainer, createTrophyCard);

                // Handle image selection for players - show modal
                playerImageInput.addEventListener('change', function(event) {
                    const files = event.target.files;
                    if (files && files.length > 0) {
                        const file = files[0];
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            playerModalImg.src = e.target.result;
                            playerCropperImg.src = e.target.result;
                            playerModal.style.display = 'flex';
                            
                            // Initialize cropper in modal
                            if (playerCropper) {
                                playerCropper.destroy();
                            }
                            playerCropper = new Cropper(playerCropperImg, {
                                aspectRatio: 3 / 4,
                                viewMode: 1,
                                autoCropArea: 0.8,
                                background: false,
                            });

                            // Modal close functionality
                            const closeBtn = playerModal.querySelector('.close');
                            closeBtn.onclick = function() {
                                playerModal.style.display = 'none';
                                playerImageInput.value = '';
                                if (playerCropper) {
                                    playerCropper.destroy();
                                    playerCropper = null;
                                }
                            };

                            cropCancel.onclick = function() {
                                playerModal.style.display = 'none';
                                playerImageInput.value = '';
                                if (playerCropper) {
                                    playerCropper.destroy();
                                    playerCropper = null;
                                }
                            };

                            // Confirm crop and add
                            cropConfirm.onclick = function() {
                                const canvas = playerCropper.getCroppedCanvas({
                                    width: 300,
                                    height: 400
                                });
                                canvas.toBlob(function(blob) {
                                    const croppedFile = new File([blob], 'cropped-image.webp', { type: 'image/webp' });
                                    const dataTransfer = new DataTransfer();
                                    dataTransfer.items.add(croppedFile);
                                    playerImageInput.files = dataTransfer.files;
                                    
                                    playerModal.style.display = 'none';
                                }, 'image/webp');
                            };
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // Handle add player form submission
                addPlayerForm.addEventListener('submit', async function(event) {
                    event.preventDefault();

                    const formData = new FormData();
                    formData.append('name', document.getElementById('playerName').value);
                    formData.append('jerseyNumber', document.getElementById('playerJerseyNumber').value);
                    formData.append('stars', document.getElementById('playerStars').value);

                    if (playerImageInput.files && playerImageInput.files.length > 0) {
                        formData.append('image', playerImageInput.files[0]);
                    }

                    await handleAddWithImage(formData, API_ENDPOINTS.players, () => {
                        addPlayerForm.reset();
                        playerImageInput.value = '';
                        if (playerCropper) {
                            playerCropper.destroy();
                            playerCropper = null;
                        }
                        loadAndDisplayData(API_ENDPOINTS.players, playersContainer, createPlayerCard);
                    });
                });

                // Handle image selection for managers - show modal
                managerImageInput.addEventListener('change', function(event) {
                    const files = event.target.files;
                    if (files && files.length > 0) {
                        const file = files[0];
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            managerModalImg.src = e.target.result;
                            managerCropperImg.src = e.target.result;
                            managerModal.style.display = 'flex';
                            
                            // Initialize cropper in modal
                            if (managerCropper) {
                                managerCropper.destroy();
                            }
                            managerCropper = new Cropper(managerCropperImg, {
                                aspectRatio: 3 / 4,
                                viewMode: 1,
                                autoCropArea: 0.8,
                                background: false,
                            });

                            // Modal close functionality
                            const closeBtn = managerModal.querySelector('.close');
                            closeBtn.onclick = function() {
                                managerModal.style.display = 'none';
                                managerImageInput.value = '';
                                if (managerCropper) {
                                    managerCropper.destroy();
                                    managerCropper = null;
                                }
                            };

                            managerCropCancel.onclick = function() {
                                managerModal.style.display = 'none';
                                managerImageInput.value = '';
                                if (managerCropper) {
                                    managerCropper.destroy();
                                    managerCropper = null;
                                }
                            };

                            // Confirm crop and add
                            managerCropConfirm.onclick = function() {
                                const canvas = managerCropper.getCroppedCanvas({
                                    width: 300,
                                    height: 400
                                });
                                canvas.toBlob(function(blob) {
                                    const croppedFile = new File([blob], 'cropped-manager.webp', { type: 'image/webp' });
                                    const dataTransfer = new DataTransfer();
                                    dataTransfer.items.add(croppedFile);
                                    managerImageInput.files = dataTransfer.files;
                                    
                                    managerModal.style.display = 'none';
                                }, 'image/webp');
                            };
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // Handle add manager form submission
                addManagerForm.addEventListener('submit', async function(event) {
                    event.preventDefault();

                    const formData = new FormData();
                    formData.append('name', document.getElementById('managerName').value);
                    formData.append('role', document.getElementById('managerRole').value);

                    if (managerImageInput.files && managerImageInput.files.length > 0) {
                        formData.append('image', managerImageInput.files[0]);
                    }

                    await handleAddWithImage(formData, API_ENDPOINTS.managers, () => {
                        addManagerForm.reset();
                        managerImageInput.value = '';
                        if (managerCropper) {
                            managerCropper.destroy();
                            managerCropper = null;
                        }
                        loadAndDisplayData(API_ENDPOINTS.managers, managersContainer, createManagerCard);
                    });
                });

                // Handle image selection for trophies - show modal
                trophyImageInput.addEventListener('change', function(event) {
                    const files = event.target.files;
                    if (files && files.length > 0) {
                        const file = files[0];
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            trophyModalImg.src = e.target.result;
                            trophyCropperImg.src = e.target.result;
                            trophyModal.style.display = 'flex';
                            
                            // Initialize cropper in modal
                            if (trophyCropper) {
                                trophyCropper.destroy();
                            }
                            trophyCropper = new Cropper(trophyCropperImg, {
                                aspectRatio: 4 / 3,
                                viewMode: 1,
                                autoCropArea: 0.8,
                                background: false,
                            });

                            // Modal close functionality
                            const closeBtn = trophyModal.querySelector('.close');
                            closeBtn.onclick = function() {
                                trophyModal.style.display = 'none';
                                trophyImageInput.value = '';
                                if (trophyCropper) {
                                    trophyCropper.destroy();
                                    trophyCropper = null;
                                }
                            };

                            trophyCropCancel.onclick = function() {
                                trophyModal.style.display = 'none';
                                trophyImageInput.value = '';
                                if (trophyCropper) {
                                    trophyCropper.destroy();
                                    trophyCropper = null;
                                }
                            };

                            // Confirm crop and add
                            trophyCropConfirm.onclick = function() {
                                const canvas = trophyCropper.getCroppedCanvas({
                                    width: 400,
                                    height: 300
                                });
                                canvas.toBlob(function(blob) {
                                    const croppedFile = new File([blob], 'cropped-trophy.webp', { type: 'image/webp' });
                                    const dataTransfer = new DataTransfer();
                                    dataTransfer.items.add(croppedFile);
                                    trophyImageInput.files = dataTransfer.files;
                                    
                                    trophyModal.style.display = 'none';
                                }, 'image/webp');
                            };
                        };
                        reader.readAsDataURL(file);
                    }
                });

                // Close modals when clicking outside
                window.onclick = function(event) {
                    if (event.target.classList.contains('image-modal')) {
                        event.target.style.display = 'none';
                        if (playerCropper) playerCropper.destroy();
                        if (managerCropper) managerCropper.destroy();
                        if (trophyCropper) trophyCropper.destroy();
                        playerImageInput.value = '';
                        managerImageInput.value = '';
                        trophyImageInput.value = '';
                    }
                };

                // Handle add trophy form submission
                addTrophyForm.addEventListener('submit', async function(event) {
                    event.preventDefault();

                    const formData = new FormData();
                    formData.append('name', document.getElementById('trophyName').value);
                    formData.append('year', document.getElementById('trophyYear').value);

                    if (trophyImageInput.files && trophyImageInput.files.length > 0) {
                        formData.append('image', trophyImageInput.files[0]);
                    }

                    await handleAddWithImage(formData, API_ENDPOINTS.trophies, () => {
                        addTrophyForm.reset();
                        trophyImageInput.value = '';
                        if (trophyCropper) {
                            trophyCropper.destroy();
                            trophyCropper = null;
                        }
                        loadAndDisplayData(API_ENDPOINTS.trophies, trophiesContainer, createTrophyCard);
                    });
                });
            }

            // Generic function to load and display data
            async function loadAndDisplayData(endpoint, container, cardCreator) {
                try {
                    const response = await fetch(endpoint);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const data = await response.json();
                    
                    const dataContainer = container.querySelector('.data-grid') || document.createElement('div');
                    dataContainer.className = 'data-grid'; // Add a class for styling
                    dataContainer.innerHTML = ''; // Clear existing data
                    
                    data.forEach(item => {
                        const card = cardCreator(item);
                        dataContainer.appendChild(card);
                    });

                    if (!container.querySelector('.data-grid')) {
                        container.appendChild(dataContainer);
                    }
                } catch (error) {
                    console.error(`Error loading data from ${endpoint}:`, error);
                    container.innerHTML = `<p>Error loading data. Please try again.</p>`;
                }
            }

            // Generic function to handle adding new data (for JSON body)
            async function handleAdd(event, endpoint, formData, callback) {
                event.preventDefault();
                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    console.log(result.message);
                    alert('Item added successfully!');
                    event.target.reset();
                    callback();
                } catch (error) {
                    console.error(`Error adding data to ${endpoint}:`, error);
                    alert('Error adding item. Please try again: ' + error.message);
                }
            }

            // Generic function to handle adding new data with image (for FormData body)
            async function handleAddWithImage(formData, endpoint, callback) {
                try {
                    const response = await fetch(endpoint, {
                        method: 'POST',
                        body: formData,
                        credentials: 'include',
                    });

                    const responseText = await response.text(); // Get response as text first

                    if (!response.ok) {
                        let errorMsg = `HTTP error! status: ${response.status}`;
                        try {
                            const errorData = JSON.parse(responseText); // Try to parse as JSON
                            errorMsg = errorData.error || errorData.message || errorMsg;
                        } catch (e) {
                            // If parsing fails, the response was not JSON. Show the raw text.
                            console.error("Server returned non-JSON error response:", responseText);
                            errorMsg = `Server returned an unexpected response: ${responseText.substring(0, 200)}`;
                        }
                        throw new Error(errorMsg);
                    }

                    // If response is OK, we still expect JSON
                    try {
                        const result = JSON.parse(responseText);
                        console.log(result.message || 'Item added successfully!');
                        alert('Item added successfully!');
                        callback();
                    } catch (e) {
                        console.error("Server returned non-JSON success response:", responseText);
                        throw new Error(`Server returned an unexpected success response: ${responseText.substring(0, 200)}`);
                    }

                } catch (error) {
                    console.error('Error adding item:', error);
                    alert(`Error adding item: ${error.message}`);
                }
            }

            // Generic function to handle deleting data
            async function handleDelete(endpoint, id, callback) {
                if (!confirm('Are you sure you want to delete this item?')) return;

                try {
                    const response = await fetch(`${endpoint}/${id}`, { method: 'DELETE', credentials: 'include' });
                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.error || `HTTP error! status: ${response.status}`);
                    }
                    
                    const result = await response.json();
                    console.log(result.message);
                    alert('Item deleted successfully!');
                    callback();
                } catch (error) {
                    console.error(`Error deleting data from ${endpoint}:`, error);
                    alert('Error deleting item. Please try again. ' + error.message);
                }
            }

            // Form data getters (updated for new player form)
            function getPlayerFormData() {
                // This function is no longer directly used for player add, as FormData is built directly
                // It remains for consistency if other parts of the code still expect it.
                return {
                    name: document.getElementById('playerName').value,
                    jerseyNumber: parseInt(document.getElementById('playerJerseyNumber').value),
                    stars: parseInt(document.getElementById('playerStars').value),
                    // imageUrl is handled by file upload
                    status: 'approved' // Default status
                };
            }

            function getManagerFormData() {
                // This function is no longer directly used for manager add, as FormData is built directly
                // It remains for consistency if other parts of the code still expect it.
                return {
                    name: document.getElementById('managerName').value,
                    role: document.getElementById('managerRole').value,
                    // imageUrl is handled by file upload
                };
            }

            function getTrophyFormData() {
                // This function is no longer directly used for trophy add, as FormData is built directly
                // It remains for consistency if other parts of the code still expect it.
                return {
                    name: document.getElementById('trophyName').value,
                    year: parseInt(document.getElementById('trophyYear').value),
                    // imageUrl is handled by file upload
                };
            }

            // Card creators
            function createPlayerCard(player) {
                const card = document.createElement('div');
                card.className = 'db-card';
                card.innerHTML = `
                    <p>${player.name} - #${player.jerseyNumber} (${player.stars} stars)</p>
                    <button class="delete-btn" data-id="${player.id}">Delete</button>
                `;
                card.querySelector('.delete-btn').addEventListener('click', () => handleDelete('/api/players', player.id, () => loadAndDisplayData('/api/players', document.getElementById('players-container'), createPlayerCard)));
                return card;
            }

            function createManagerCard(manager) {
                const card = document.createElement('div');
                card.className = 'db-card';
                card.innerHTML = `
                    <p>${manager.name} (${manager.role})</p>
                    <button class="delete-btn" data-id="${manager.id}">Delete</button>
                `;
                card.querySelector('.delete-btn').addEventListener('click', () => handleDelete('/api/managers', manager.id, () => loadAndDisplayData('/api/managers', document.getElementById('managers-container'), createManagerCard)));
                return card;
            }

            function createTrophyCard(trophy) {
                const card = document.createElement('div');
                card.className = 'db-card';
                card.innerHTML = `
                    <p>${trophy.name} (${trophy.year})</p>
                    <button class="delete-btn" data-id="${trophy.id}">Delete</button>
                `;
                card.querySelector('.delete-btn').addEventListener('click', () => handleDelete('/api/trophies', trophy.id, () => loadAndDisplayData('/api/trophies', document.getElementById('trophies-container'), createTrophyCard)));
                return card;
            }
        });
    </script>
</body>
</html>
